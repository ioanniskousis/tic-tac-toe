#!/usr/bin/env ruby
require_relative '../lib/game'
require_relative '../lib/interface'
require_relative '../lib/centralizer'

game = Game.new
interface = Interface.new
centralizer = Centralizer.new

instructions_given = false

loop do
  system('cls') || system('clear')
  unless instructions_given
    puts centralizer.centralize("**GAME INSTRUCTIONS**")
    puts centralizer.centralize("The goal of the game is to align your symbols in a row, column or diagonal")
    puts centralizer.centralize("One player uses \"X\" and the other player uses \"O\"")
    puts centralizer.centralize("The game starts with player 1, if there is no winner, players are swaped.")
    puts centralizer.centralize("The winner becomes the second player if we continue to play.")
    puts
    puts
    instructions_given = true
  end
  lines = interface.draw(game.grid)
  lines.each { |line| puts centralizer.centralize(line) }
  if game.error_message.size.positive?
    puts centralizer.centralize(game.error_message)
    puts
    game.delete_error
  end

  if game.game_over == true
    puts
    if game.winner.positive?
      puts centralizer.centralize("Player #{game.winner} is the winner! Do you want to play again? (y)")
    else
      puts centralizer.centralize('Game is Over! Do you want to play again? (y)')
    end
    puts
    print centralizer.centralize("")
    choice = gets.chomp
    break unless choice.downcase == 'y'

    game.init
  else
    puts
    puts centralizer.centralize("Player #{game.current_player} : It's Your Turn")
    puts
    puts centralizer.centralize("Available cells #{game.available}")
    puts centralizer.centralize('Enter Z to end the game')
    puts
    print centralizer.centralize("")
    choice = gets.chomp
    break if choice.downcase == 'z'

    game.check(choice.to_i)
  end
end
