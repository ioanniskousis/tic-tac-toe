#!/usr/bin/env ruby
require_relative '../lib/game'
require_relative '../lib/interface'

game = Game.new
interface = Interface.new

instructions_given = false

loop do
  system('cls') || system('clear')
  unless instructions_given
    puts "**GAME INSTRUCTIONS**"
    puts "The goal of the game is to align your symbols in a row, column or diagonal"
    puts "One player uses \"X\" and the other player uses \"O\""
    puts "The game starts with player 1, if there is no winner, players are swaped."
    puts "The winner becomes the second player if we continue to play."
    puts
    puts
    instructions_given = true
  end
  lines = interface.draw(game.grid)
  lines.each { |line| puts line }
  if game.error_message.size.positive?
    puts game.error_message
    puts
    game.delete_error
  end

  if game.game_over == true
    puts
    if game.winner.positive?
      puts "Player #{game.winner} is the winner! Do you want to play again? (y)"
    else
      puts 'Game is Over! Do you want to play again? (y)'
    end
    choice = gets.chomp
    break unless choice.downcase == 'y'

    game.init
  else
    puts "Your turn Player #{game.current_player}"
    puts "Available cells #{game.available}"
    puts 'Enter Z to end the the game'
    choice = gets.chomp
    break if choice.downcase == 'z'

    game.check(choice.to_i)
  end
end
